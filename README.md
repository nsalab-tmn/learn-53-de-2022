## Запуск лабораторного окружения

- Разверните лабораторное окружение с помощью кнопки "Запланировать".
- После того, как лабораторное окружение будет готово, нажмите кнопку "Открыть консоль".
- Используейте сгенерированные учетные данные (логин и пароль) для входа на портал Microsoft Azure (https://portal.azure.com).
- Откажитесь от настройки многофакторной аутентификации и перейдите на главную панель портала Azure, выберите раздел "Группы ресурсов".
- Вам будет доступна сгенерированная группа ресурсов, все остальные ресурсы вам необходимо создавать исключительно в рамках данной группы ресурсов.

## О проекте
Целью текущего проекта является развертывание приложения в отказоустойчивой масштабируемой инфраструктуре на платформе Azure. В вашем распоряжении имеется ограниченный набор сервисов, который включается в себя:
* Virtual Machines
* Container Instances
* Cosmos DB
* Cache for Redis
* Blob storage
* Virtual Network
* Load Balancer

Вышеуказанный перечень сервисов является достаточным для выполнения задания, однако нет необходимости использовать все сервисы одновременно.

Все необходимые роли преднастроены, конфигурация RBAC не требуется.

## Описание приложения
Приложение представляется из себя небольшой веб-сервер. При необходимости переменные, такие как имя таблицы и путь до кластера Redis, можно задать в файле env.yml. Для проверки работоспособности приложения используйте страницу `/status`.

Для оценки здоровья сервера сторонними сервисами используйте страницу `/health`.

## Оценка выполнения задания
После выполнения задания вам необходимо будет указать точку входа в развернутое приложение в формате `http://[IP-адрес]:[порт]` или `http://[FQDN]:[порт]` в поле "Адрес приложения". Для завершения лабораторной работы нажмите кнопку "Отправить ответы и завершить". 

Перед завершением лабораторной работы, убедитесь в том, что:
- адрес точки входа в приложение введен без ошибок, в том числе 
  - доменное имя или IP-адрес указаны верно;
  - протокол указан верно (http или https);
  - порт указан верно;
- приложение доступно из веб браузера.

После завершения работы механизм оценки будет использовать данную точку входа в ваше приложение для проведения функциональных нагрузок и проверки выполнения условий автоматического масштабирования.

## Техническое задание
При создании инфраструктуры в следуйте нижеописанным инструкциям и используйте указанные значения (где применимо). Обратите внимание на то, что данные значения будут использоваться при проверке нефункциональных критериев.

### Сетевая инфраструктура
Инфраструктура должна быть расположена в отдельной виртуальной сети. Определите адресацию и размер подсетей по своему усмотрению. Ограничьтесь двумя зонами доступности.

### Объектное хранилище
Дистрибутив приложения может быть расположен в отдельном объектном хранилище (Blob Storage).

### Шлюз приложения (Application gateway)
* Для пользователей из сети интернет приложение должно быть доступно по протоколу HTTP на порту **80**.
* Внутри инфраструктуры application gateway должен быть направлен на порт **8080**.
* Имя Application gateway должно быть **web53-AppGW**

Используйте страницу `/health` для проверки состояния веб-сервера.

### Автоматическое массштабирование
Группа масштабирования должна иметь следующие параметры:

* Name: web53-ScaleSet
* Min instances: 1
* Max: 4
* Desired: 1
* Scaling Policy: Requests per instance
* Scale out: >= 10
* Scale in: < 10
* Warm: 60 sec
* Cooldown: 60 sec
* Autoscale setting name: web53-AutoScale

Убедитесь, что приложение запускается корректно

### База данных
Создайте базу данных **CosmosDB**. После этого создайте контейнер. Контейнер должна содержать только Partition Key (без Unique Key).

Укажите имя вашей базы данных и ссылку на неё, имя контейнера и ключа (Partition Key) в конфигурационном файле приложения (env.yml).

### Кэширующая база данных (Redis)
Кластер Redis должен быть развернут со следующими параметрами:

* Имя кластера: **web53-xxxx**, где xxxx - любые символы, чтобы ваше имя кластера было уникально (имя обязательно должно содержать префикс **web53**)
* Размер инстанса: **C0**

Укажите адрес и порт развернутого кластера в конфигурационном файле приложения (env.yml).

## Архитектура
На диаграмме представлена референсная архитектура создаваемой вами инфраструктуры. Ваше решение может отличаться, однако оно должно отвечать следующим требованиям:
* приложение должно быть отказоустойчивым на уровне региона (East US);
* инфраструктура должна автоматически масштабироваться в зависимости от количества запросов на каждый инстанс/контейнер;
* предпочитаемый размер инстанса приложения / кластера контейнеров должен быть **B1s**.

![Diagram](./assets/diagram.svg)

## Приложение

* [Скачать файл приложение](./assets/app.py)
* [Скачать файл с переменными для приложения](./assets/env.yaml)
* [Скачать файл с зависимостями для приложения](./assets/requirements.txt)
