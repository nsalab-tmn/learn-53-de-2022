## Развертывание приложения в отказоустойчивой масштабируемой инфраструктуре
### О проекте
Целью текущего проекта является развертывание приложения в отказоустойчивой масштабируемой инфраструктуре на платформе Azure. В вашем распоряжении имеется ограниченный набор сервисов, который включается в себя:
* Virtual Machines
* Container Instances
* Cosmos DB
* Cache for Redis
* Blob storage
* Virtual Network
* Load Balancer

Вышеуказанный перечень сервисов является достаточным для выполнения задания, однако нет необходимости использовать все сервисы одновременно.

Все необходимые роли преднастроены, конфигурация RBAC не требуется.

### Описание приложения
Приложение представляется из себя небольшой веб-сервер. При необходимости переменные можете задать в файле env.yml, такие как имя таблицы, путь до кластера Redis. Для проверки работоспособности приложения можете использовать страницу /status.

Для оценки здоровья сервера другими сервисами можете использовать страницу /health.

### Базовое состояние
Вам предоставлена учетная запись для доступа в Azure Portal. После выполнения задания вам необходимо будет указать точку входа в развернутое приложение в формате `http://[IP-адрес]:[порт]` или `http://[FQDN]:[порт]` в поле "Адрес приложения". Вам необходимо будет залогиниться через Azure.

Задание и учетные данные для Azure Portal расположены в дашборде.

## Техническое задание
### Virtual Network
Инфраструктура должна быть расположена в отдельном Virtual Network. Определите адресацию и размер подсетей по своему усмотрению. Ограничьтесь двумя зонами доступности.

### Blob Storage
Дистрибутив приложения может быть расположен в отдельном Blob Storage.

### Application gateway
* Для пользователей из сети интернет сервис должен быть доступен по протоколу HTTP на порту 80.
* Внутри инфраструктуры application gateway должен быть направлен на порт 8080.
* Имя Application gateway должно быть **web53-AppGW**

Используйте страницу `/health` для проверки состояния веб-сервера.

### Auto Scaling
Группа должна иметь следующие параметры:

* Name: web53-ScaleSet
* Min instances: 1
* Max: 4
* Desired: 1
* Scaling Policy: Requests per instance
* Scale out: >= 20
* Scale in: < 20
* Warm: 60 sec
* Cooldown: 60 sec
* Autoscale setting name: web53-AutoScale

Убедитесь, что приложение запускается корректно

### Cosmos DB
Создайте базу данных CosmosDB. После этого создайте контейнер. Контейнер должна содержать только Partition Key (без Unique Key).

Укажите имя вашей базы данных и ссылку на неё, имя контейнера, Partition Key и ключа в конфигурационном файле приложения (env.yml).

### Redis
Кластер должен быть развернут со следующими параметрами:

* Имя кластера: web53-xxxx, где xxxx - любые символы, чтобы ваше имя кластера было уникально, главное, чтобы имя содержало **web53**
* Размер инстанса: C0
* Подключение к кластеру: Private Endpoint


Укажите адрес и порт развернутого кластера в конфигурационном файле приложения (env.yml).

## Архитектура
На диаграмме представлена референсная архитектура создаваемой вами инфраструктуры. Ваше решение может отличаться, однако оно должно отвечать следующим требованиям:
* приложение должно быть отказоустойчивым на уровне региона (West US 2);
* инфраструктура должна автоматически масштабироваться в зависимости от количества запросов на каждый инстанс/контейнер;
* предпочитаемый размер инстанса приложения / кластера контейнеров должен быть **B1s**.

![Diagram](./assets/diagram.svg)

## Приложение

* [Скачать файл приложение](./assets/app.py)
* [Скачать файл с переменными для приложения](./assets/env.yaml)
* [Скачать файл с зависимостями для приложения](./assets/requirements.txt)
